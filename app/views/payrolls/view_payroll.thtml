<?php if (!$disableEdit): ?>
<script>
function inlineEdit(attr){
	var key = "cell"+attr.userid+attr.field;
	$("#"+key+"View").hide();
	$("#"+key+"Edit").show();
	$("#"+key).focus();
}
function cancel(attr){
	var key = "cell"+attr.userid+attr.field;
	$("#"+key).val("");
	$("#"+key+"Edit").hide();
	$("#"+key+"View").show();
}
function changeField(attr){
	if (<?=$pay_period?><=0) {
		alert('Please, select a pay period, not a custom date interval!');
		return;
	}
	var key = "cell"+attr.userid+attr.field;
	
	var val = $("#"+key).val();

	$.post("<?=BASE_URL;?>/payrolls/changePayrollField",
		{userid:attr.userid,field:attr.field,payperiod:<?=$pay_period?>,value:val},
		function(data){
			//alert(data);
			document.viewform.submit();
		}
	);
}
</script>
<style type="text/css">
	a {
		cursor: pointer;
	}
	.total td {
		font-weight: bold;
		line-height: 16px;
		border-top:1px solid #9f9f9f;
		border-right:none;
		border-left:1px solid #9f9f9f;
		color: black;
	}
	
	.cell1 .highlight {
		background-color:#F96;	
	}
	
	.cell0 .highlight {
		background-color:#FC9;	
	}
	
</style>
<?php endif; ?>

<form method="GET" action="<?= $PHP_SELF?>" name="viewform">
<input type="hidden" name="action" value="view" >
<input type="hidden" name="order" value="<?=$_GET['order']?>">
<input type="hidden" name="sort" value="<?=$_GET['sort']?>">
<input type="hidden" name="paginationList1" value="<?=$_GET['paginationList1']?>">

<!-- TABLE :: FILTER -->
<!-- *************** -->
<table width="800">
	<tr>
		<td class="sectionTitle" colspan=3>Payroll</td>
	</tr>
	<tr>
		<td>
			Pay period:&nbsp;
			<select name="pay_period" onchange="document.viewform.submit();">
				<option value="-1" <?=($pay_period<0?'selected':'')?>>-=Custom=-</option>
			<?php foreach ($allPayPeriods as $v => $k) {
				$selected = '';
				if ($v == $pay_period) $selected = 'selected';?>
				<option value="<?=$v?>" <?=$selected?>><?=$k?></option>
			<?php } ?>
			</select>
		</td>
		<td style="<?=$disabled?>">Date from: 
			&nbsp;&nbsp;
			<input type="button" value="&lt;&lt;" class="buttons" onclick="document.viewform.ffromdate.value='<?=$prev_fdate?>'; document.viewform.ftodate.value='<?=$prev_fdate?>'; document.viewform.submit();" style="font-size: 8pt;">
			&nbsp;&nbsp;
			<input type="text" name="ffromdate" class="emboss" style="width: 85px; cursor: hand; cursor: pointer;" readonly="1" onclick="scwShow(this,event);" onkeydown="return false;" value="<?=$fdate?>">
			&nbsp;&nbsp;Date to:&nbsp;&nbsp;
			<input type="text" name="ftodate" class="emboss" style="width: 85px; cursor: hand; cursor: pointer;" readonly="1" onclick="scwShow(this,event);" onkeydown="return false;" value="<?=$tdate?>">
			&nbsp;&nbsp;
			<input type="button" value="&gt;&gt;" class="buttons" onclick="document.viewform.ffromdate.value='<?=$next_tdate?>'; document.viewform.ftodate.value='<?=$next_tdate?>'; document.viewform.submit();" style="font-size: 8pt;">
		</td>
		<td align="left">
			<input type="submit" name="submit2" onclick="return SearchRecords();" id="submit2" value="Update" class="buttons">
		</td>			
	</tr>
</table> 	

</form>

<!-- TABLE :: RESULT -->
<!-- *************** -->
<table class="results" cellpadding="3" cellspacing="0" style="border-style: solid;border-width:1px;">
<tr>
	<th width="200"><a href="javascript:setOrder('employee_name')">Employee Name</a></th>
	<th width="50"><a href="javascript:setOrder('hours')">Total Hours</a></th>
<?php if (!$disableEdit): ?>
	<th width="50"><a href="javascript:setOrder('rate')">Rate</a></th>
<?php endif; ?>
	<th width="80"><a href="javascript:setOrder('wage')">Wage</a></th>
    <th width="80"><a href="javascript:setOrder('wage')">Scaled Rate</a></th>
    <th width="80"><a href="javascript:setOrder('wage')">Scaled Wage</a></th>
    <th width="80"><a href="javascript:setOrder('wage')">Eff Ratio</a></th>
    <th width="80"><a href="javascript:setOrder('wage')">Ratio Rate</a></th>
    <th width="80"><a href="javascript:setOrder('wage')">Ratio Wage</a></th>
	<th width="80"><a href="javascript:setOrder('bonus')">Bonus</a></th>
	<th width="80"><a href="javascript:setOrder('adj')">Adjustment</a></th>
	<th width="80"><a href="javascript:setOrder('gross')">Gross pay</a></th>
    <th width="80"><a href="javascript:setOrder('gross')">Scaled Gross pay</a></th>
    <th width="80"><a href="javascript:setOrder('gross')">Ratio Gross pay</a></th>
	<th width="80"><a href="javascript:setOrder('furnace')">Furnace, Boiler</a></th>
	<th width="80"><a href="javascript:setOrder('airduct')">Airduct</a></th>
    <th width="80"><a href="javascript:setOrder('airduct')">Estimate</a></th>
    <th width="80"><a href="javascript:setOrder('carpet')">Carpet</a></th>
    <th width="80"><a href="javascript:setOrder('hot_water_tank')">Hot Water Tank</a></th>
    <th width="80"><a href="javascript:setOrder('fire_place')">Fire Place</a></th>
	<!--<th width="80"><a href="javascript:setOrder('others')">Other</a></th>-->
	<th width="80"><a href="javascript:setOrder('jobs_done')">Total Bookings Done</a></th>
<?php if (!$disableEdit): ?>
<!--
	<th width="80"><a href="javascript:setOrder('jobs_amount')">Total Amount of Booking</a></th>
-->
<?php endif; ?>
</tr>
<?php $r=1;
$total = array();
foreach ($items as $key => $obj) {
if($obj['employee'] != '') { 
	$class = 'cell'.(++$r%2);
	//$id = "cell".$obj["id"];
	$id = "cell".$key;
	$total["hours"] += $obj["hours"];
	$total["wage"] += $obj["wage"];
	$total["scaled_wage"] += $obj["scaled_wage"];
	$total["ratio_wage"] += $obj["ratio_wage"];
	$total["bonus"] += $obj["bonus"];
	$total["adj"] += $obj["adj"];
	$total["gross"] += $obj["gross"];
	$total["scaled_gross"] += $obj["scaled_gross"];
	$total["ratio_gross"] += $obj["ratio_gross"];
	$total["furnace"] += $obj["furnace"];
	$total["airduct"] += $obj["airduct"];
	$total["estimate"] += $obj["estimate"];
	$total["carpet"] += $obj["carpet"];
	$total["hot_water_tank"] += $obj["hot_water_tank"];
	$total["fire_place"] += $obj["fire_place"];
	$total["others"] += $obj["others"];
	$total["jobs_done"] += $obj["jobs_done"];
	$total["jobs_amount"] += $obj["jobs_amount"];
?>
<tr class="<?= $class ?>">
	<td><a href="<?=BASE_URL?>/payrolls/time_sheet?userid=<?=$obj['id']?>&pay_period=<?=$pay_period?>"><?=$obj["employee"]; ?>&nbsp;</a></td>
	<td align="right"><?=$obj["hours"] ?>&nbsp;</td>
<?php if (!$disableEdit): ?>
	<td align="right"><?=$obj["rate"] ?>&nbsp;</td>
	<td align="right"><?=$obj["wage"] ?>&nbsp;</td>
<?php endif; ?>
	<td align="right"><?=$obj["scaled_rate"] ?>&nbsp;</td>
	<td align="right"><?=$obj["scaled_wage"] ?>&nbsp;</td>
    <td align="right" class="highlight"><?=$obj["efficiency_ratio"] ?>&nbsp;</td>
    <td align="right" class="highlight"><?=$obj["ratio_rate"] ?>&nbsp;</td>
	<td align="right" class="highlight"><?=$obj["ratio_wage"] ?>&nbsp;</td>
<?php foreach (array('bonus','adj') as $field): ?>
<?php 	$attr = "{userid:{$key},field:'$field'}"; ?>
<?php 	$sid = $id.$field; ?>
	<td align="right" class="highlight"><!--(<?php echo $obj['id'] ?>)(<?php echo $key ?>)(<?php echo $sid ?>)-->
		<!--<a id="<?=$sid?>View" onclick="inlineEdit(<?=$attr?>);return false;"><?=$HtmlAssist->prPrice($obj[$field])?>&nbsp;</a>-->
        <a id="<?=$sid?>View" onclick="inlineEdit(<?=$attr?>);return false;"><?php echo $obj[$field]?>&nbsp;</a>
		<div id="<?=$sid?>Edit" style="display:none;">
			<input style="width:60px;" id="<?=$sid?>" onchange="changeField(<?=$attr?>)" type="text" value=""/><br/>
			<a onclick="changeField(<?=$attr?>);return false;">Save</a>
			&nbsp;
			<a onclick="cancel(<?=$attr?>);return false;">Cancel</a>
		</div>
	</td>
<?php endforeach; ?>
	<td align="right"><?=$obj["gross"] ?>&nbsp;</td>
    <td align="right"><?=$obj["scaled_gross"] ?>&nbsp;</td>
    <td align="right" class="highlight"><?=$obj["ratio_gross"] ?>&nbsp;</td>
	<td align="right"><?=$obj["furnace"] ?>&nbsp;</td>
	<td align="right"><?=$obj["airduct"] ?>&nbsp;</td>
    <td align="right"><?=$obj["estimate"] ?>&nbsp;</td>
    <td align="right"><?=$obj["carpet"] ?>&nbsp;</td>
    <td align="right"><?=$obj["hot_water_tank"] ?>&nbsp;</td>
    <td align="right"><?=$obj["fire_place"] ?>&nbsp;</td>
	<!--<td align="right"><?=$obj["others"] ?>&nbsp;</td>-->
	<td align="right"><?=$obj["jobs_done"] ?>&nbsp;</td>
<?php if (!$disableEdit): ?>
	<!--
	<td align="right"><?=$obj["jobs_amount"] ?>&nbsp;</td>
    -->
<?php endif; ?>
</tr>
<?php }} //end foreach ?>
<tr class="total">
	<td align="right"><b>Total:</b></td>
	<td align="right"><?=$total["hours"] ?>&nbsp;</td>
<?php if (!$disableEdit): ?>
	<td align="right">&nbsp;</td>
	<td align="right"><?=$total["wage"] ?>&nbsp;</td>
<?php endif; ?>
	<td align="right">&nbsp;</td>
	<td align="right"><?=$total["scaled_wage"] ?>&nbsp;</td>
    <td align="right">&nbsp;</td>
    <td align="right">&nbsp;</td>
    <td align="right"><?=$total["ratio_wage"] ?>&nbsp;</td>
	<td align="right"><?=$total["bonus"] ?>&nbsp;</td>
	<td align="right"><?=$total["adj"] ?>&nbsp;</td>
	<td align="right"><?=$total["gross"] ?>&nbsp;</td>
    <td align="right"><?=$total["scaled_gross"] ?>&nbsp;</td>
    <td align="right"><?=$total["ratio_gross"] ?>&nbsp;</td>
	<td align="right"><?=$total["furnace"] ?>&nbsp;</td>
	<td align="right"><?=$total["airduct"] ?>&nbsp;</td>
    <td align="right"><?=$total["estimate"] ?>&nbsp;</td>
    <td align="right"><?=$total["carpet"] ?>&nbsp;</td>
    <td align="right"><?=$total["hot_water_tank"] ?>&nbsp;</td>
    <td align="right"><?=$total["fire_place"] ?>&nbsp;</td>
	<!--<td align="right"><?=$total["others"] ?>&nbsp;</td>-->
	<td align="right"><?=$total["jobs_done"] ?>&nbsp;</td>
<?php if (!$disableEdit): ?>
	<!--
	<td align="right"><?=$total["jobs_amount"] ?>&nbsp;</td>
    -->
<?php endif; ?>
</tr>
</table>
<!--
<pre>
<?php print_r($items) ?>
</pre>
-->

