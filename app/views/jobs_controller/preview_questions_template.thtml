<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Preview Questions Template</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 12px;
        }
        
        .hide {
            display: none;
        }
        
        .rank {
            width: 30px;
            text-align: right;
        }
        
        .value {
            width: 200px;
        }
        
        .response {
            width: 200px;
        }
        
        .suggestion {
            width: 200px;
        }
        
        .decision {
            width: 200px;
        }
        
        .delete_box {
            background-color: #C00;
            color: #F93;
            padding: 4px 1px 2px;
            border-radius: 5px;
        }
        
        .notify_box {
            background-color: #090;
            color: #9F0;
            padding: 4px 1px 2px;
            border-radius: 5px;
        }
        
        select {
            width: 200px;
        }
        
        input[type=text] {
            width: 200px;
        }
        
        #questions_template {
            border: 1px solid #CCC;
            border-collapse: collapse;
        }
        
        #questions_template th {
            background-color: #0A304E;
            padding: 7px;
            color: #fff;
        }
        
        #questions_template .even_row {
            background-color: #dcf1ef;
        }
        
        #questions_template td {
            padding: 2px;
        }
    </style>
    <script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/jquery-1.5.1.min.js"></script>
    <script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/jquery-ui-1.8.21.custom.min.js"></script>
    <link rel="stylesheet" type="text/css" media="all" href="<?=ROOT_URL;?>/app/webroot/css/ui-smooth/jquery-ui-1.8.13.custom.css" />
    <script type="text/javascript">
        var index = 0;
        $(function() {

            //--------dropdown response-------

            $(".responses").change(function() {
                var question_id = $(this).prev(".question_id").val();
                var response_id = $(this).val();
                $(".q" + question_id).addClass("hide");
                $("#r" + response_id).removeClass("hide");
            });

            $(".suggestions").change(function() {
                var response_id = $(this).prev(".response_id").val();
                var suggestion_id = $(this).val();
                $(".r" + response_id).addClass("hide");
                $("#s" + suggestion_id).removeClass("hide");
            });

            //--------text response-----------

            $(".text_response").change(function() {

                var question_id = $(this).prev(".question_id").val();
                var text_response = $(this).val();
                var response_id = 0;

                $(".q" + question_id).addClass("hide");


                $(this).next(".response_codes").children(".code").each(function() {
                    var id = $(this).children(".id").val();
                    var operation_id = $(this).children(".operation_id").val();
                    var which_id = $(this).children(".which_id").val();
                    var value;

                    if (which_id == 1) {
                        value = $(this).children(".value").val();
                    } else if (which_id == 2) {
                        var input = $(".rank" + $(this).children(".value").val());
                        if (input.is("select")) value = input.find('option:selected').text();
                        else value = input.val();
                    }

                    if (!isNaN(value)) value = parseInt(value);

                    switch (operation_id) {
                        case '1':
                            if (text_response == value) {

                                response_id = id;
                                return false;
                            }
                            break;
                        case '2':
                            if (text_response > value) {
                                response_id = id;
                                return false;
                            }
                            break;
                        case '3':
                            if (text_response >= value) {
                                response_id = id;
                                return false;
                            }
                            break;
                        case '4':
                            if (text_response < value) {

                                response_id = id;
                                return false;
                            }
                            break;
                        case '5':
                            if (text_response <= value) {

                                response_id = id;
                                return false;
                            }
                            break;
                        case '6':
                            if (text_response != value) {

                                response_id = id;
                                return false;
                            }
                            break;
                    }

                    response_id = 0;

                });

                $("#r" + response_id).removeClass("hide");
            });
            /******************************/

            $(".responses,.suggestions").change(function() {
                $('.reminders').addClass('hide');
            });
            $(".decisions").change(function() {
                var decision_id = $(this).find("option:selected").val();
                $('.reminders#rem' + decision_id).removeClass('hide');
            });
            // $('.reminders').datepicker();
        });
    </script>
</head>

<body>
    <a href="<?=BASE_URL;?>/jobs/editQuestionsTemplate?item_id=<?php echo $item_id ?>">Back to template</a>
    <a href="<?=BASE_URL;?>/jobs/">Back to Job Types</a>
    <table id="questions_template">
        <tr>
            <th>#</th>
            <th>Questions</th>
            <th>Responses</th>
            <th>Suggestions</th>
            <th>Decisions</th>
            <th>Code</th>
        </tr>
        <?php $row = ""; $index = 1;?>
        <?php foreach($questions as $question_id => $question) { ?>
        <?php $row = $index++%2==0?"even_row":"";?>
        <?php if($question['type'] == 'dropdown') { ?>
        <tr>
            <td class="<?php echo $row ?>">
                <?php echo $question['rank'] ?>
            </td>
            <td class="<?php echo $row ?>">
                <?php echo $question['value'] ?>
            </td>
            <td class="<?php echo $row ?>">
                <?php if(count($responses[$question_id]) > 0) { ?>
                <input type="hidden" class="question_id" value="<?php echo $question_id ?>" />
                <select class="responses rank<?php echo $question['rank'] ?>">
        	<option value="">--</option>
       		<?php foreach($responses[$question_id] as $response_id => $response) { ?>
        	<option value="<?php echo $response_id ?>"><?php echo $response['value'] ?></option>
        	<?php }//END foreach($responses[$question_id] as $response_id => $response) ?>
        </select>
                <?php }//END if ?>
            </td>
            <td class="<?php echo $row ?>">
                <?php if(count($responses[$question_id]) > 0) { ?>
                <?php foreach($responses[$question_id] as $response_id => $response) { ?>

                <?php if(count($suggestions[$response_id]) > 0) { ?>
                <input type="hidden" class="response_id" value="<?php echo $response_id ?>" />
                <select class="suggestions hide q<?php echo $question_id ?>" id="r<?php echo $response_id ?>">
                <option value="">--</option>
                <?php foreach($suggestions[$response_id] as $suggestion_id => $suggestion) { ?>
                <option value="<?php echo $suggestion_id ?>"><?php echo $suggestion['value'] ?></option>
                <?php }//END foreach($suggestions[$response_id] as $suggestion_id => $suggestion) ?>
            </select>
                <?php }//END if ?>

                <?php }//END foreach($responses[$question_id] as $response_id => $response) ?>
                <?php }//END if ?>
            </td>
            <td class="<?php echo $row ?>">
                <?php if(count($responses[$question_id]) > 0) { ?>
                <?php foreach($responses[$question_id] as $response_id => $response) { ?>

                <?php if(count($suggestions[$response_id]) > 0) { ?>
                <?php foreach($suggestions[$response_id] as $suggestion_id => $suggestion) { ?>

                <?php if(count($decisions[$suggestion_id]) > 0) { ?>
                <input type="hidden" class="suggestion_id" value="<?php echo $suggestion_id ?>" />
                <select class="decisions hide q<?php echo $question_id ?> r<?php echo $response_id ?>" id="s<?php echo $suggestion_id ?>">
                    <option value="">--</option>
					<?php foreach($decisions[$suggestion_id] as $decision_id => $decision) { ?>
                    <option value="<?php echo $decision_id ?>"><?php echo $decision['value'] ?></option>
                    <?php }//END foreach($decisions[$suggestion_id] as $decision_id => $decision) ?>
                </select>
                <?php }//END if ?>

                <?php }//END foreach($suggestions[$response_id] as $suggestion_id => $suggestion) ?>
                <?php }//END if ?>

                <?php }//END foreach($responses[$question_id] as $response_id => $response) ?>
                <?php }//END if ?>
            </td>

            <!-------------------jack hutson--------->

            <td class="<?php echo $row ?>">
                <?php if(count($responses[$question_id]) > 0) { ?>
                <?php foreach($responses[$question_id] as $response_id => $response) { ?>

                <?php if(count($suggestions[$response_id]) > 0) { ?>
                <?php foreach($suggestions[$response_id] as $suggestion_id => $suggestion) { ?>

                <?php if(count($decisions[$suggestion_id]) > 0) { ?>
                <?php foreach($decisions[$suggestion_id] as $decision_id => $decision) { ?>

                <input type="hidden" class="decision_id" value="<?php echo $decision_id ?>" />
                <?php if(count($reminders[$decision_id]) > 0) {  ?>
                <?php //foreach($reminders[$decision_id] as $reminder_id => $reminder) { ?>

                <?php //if($decision_id == $remainder) { ?>
                <input type="text" class="reminders hide" id="rem<?php echo $decision_id;?>" value="<?php echo $reminders[$decision_id]['value'];?>">
                <?php //} ?>
                <?php //} //END foreach ?>
                <?php } //END if ?>
                <?php }//END foreach decision?>
                <?php }//END if ?>

                <?php }//END foreach($suggestions[$response_id] as $suggestion_id => $suggestion) ?>
                <?php }//END if ?>

                <?php }//END foreach($responses[$question_id] as $response_id => $response) ?>
                <?php }//END if ?>
            </td>


        </tr>
        <?php }//END if($question['type'] == 'dropdown') ?>
        <?php if($question['type'] == 'text') { ?>
        <tr>
            <td class="<?php echo $row ?>">
                <?php echo $question['rank'] ?>
            </td>
            <td class="<?php echo $row ?>">
                <?php echo $question['value'] ?>
            </td>
            <td class="<?php echo $row ?>">
                <?php if(count($responses[$question_id]) > 0) { ?>
                <input type="hidden" class="question_id" value="<?php echo $question_id ?>" />
                <input type="text" class="text_response rank<?php echo $question['rank'] ?>" />
                <div class="response_codes">
                    <?php foreach($responses[$question_id] as $response_id => $response) { ?>
                    <div class="code">
                        <input type="hidden" class="rank" value="<?php echo $question['rank'] ?>" />
                        <input type="hidden" class="id" value="<?php echo $response_id ?>" />
                        <input type="hidden" class="operation_id" value="<?php echo $response['operation_id'] ?>" />
                        <input type="hidden" class="which_id" value="<?php echo $response['which_id'] ?>" />
                        <input type="hidden" class="value" value="<?php echo $response['value'] ?>" />
                    </div>
                    <?php }//END foreach($responses[$question_id] as $response_id => $response) ?>
                </div>
                <?php }//END if ?>
            </td>
            <td class="<?php echo $row ?>">
                <?php if(count($responses[$question_id]) > 0) { ?>
                <?php foreach($responses[$question_id] as $response_id => $response) { ?>

                <?php if(count($suggestions[$response_id]) > 0) { ?>
                <input type="hidden" class="response_id" value="<?php echo $response_id ?>" />
                <select class="suggestions hide q<?php echo $question_id ?>" id="r<?php echo $response_id ?>">
                <option value="">--</option>
                <?php foreach($suggestions[$response_id] as $suggestion_id => $suggestion) { ?>
                <option value="<?php echo $suggestion_id ?>"><?php echo $suggestion['value'] ?></option>
                <?php }//END foreach($suggestions[$response_id] as $suggestion_id => $suggestion) ?>
            </select>
                <?php }//END if ?>

                <?php }//END foreach($responses[$question_id] as $response_id => $response) ?>
                <?php }//END if ?>
            </td>
            <td class="<?php echo $row ?>">
                <?php if(count($responses[$question_id]) > 0) { ?>
                <?php foreach($responses[$question_id] as $response_id => $response) { ?>

                <?php if(count($suggestions[$response_id]) > 0) { ?>
                <?php foreach($suggestions[$response_id] as $suggestion_id => $suggestion) { ?>

                <?php if(count($decisions[$suggestion_id]) > 0) { ?>
                <input type="hidden" class="suggestion_id" value="<?php echo $suggestion_id ?>" />
                <select class="decisions hide q<?php echo $question_id ?> r<?php echo $response_id ?>" id="s<?php echo $suggestion_id ?>">
                    <option value="">--</option>
					<?php foreach($decisions[$suggestion_id] as $decision_id => $decision) { ?>
                    <option value="<?php echo $decision_id ?>"><?php echo $decision['value'] ?></option>
                    <?php }//END foreach($decisions[$suggestion_id] as $decision_id => $decision) ?>
                </select>
                <?php }//END if ?>

                <?php }//END foreach($suggestions[$response_id] as $suggestion_id => $suggestion) ?>
                <?php }//END if ?>

                <?php }//END foreach($responses[$question_id] as $response_id => $response) ?>
                <?php }//END if ?>
            </td>

            <!-------------------jack hutson--------->

            <td class="<?php echo $row ?>">
                <?php if(count($responses[$question_id]) > 0) { ?>
                <?php foreach($responses[$question_id] as $response_id => $response) { ?>

                <?php if(count($suggestions[$response_id]) > 0) { ?>
                <?php foreach($suggestions[$response_id] as $suggestion_id => $suggestion) { ?>

                <?php if(count($decisions[$suggestion_id]) > 0) { ?>
                <?php foreach($decisions[$suggestion_id] as $decision_id => $decision) { ?>

                <input type="hidden" class="decision_id" value="<?php echo $decision_id ?>" />
                <?php if(count($reminders[$decision_id]) > 0) {  ?>
                <?php //foreach($reminders[$decision_id] as $reminder_id => $reminder) { ?>

                <?php //if($decision_id == $remainder) { ?>
                <input type="text" class="reminders hide" id="rem<?php echo $decision_id;?>" value="<?php echo $reminders[$decision_id]['value'];?>">
                <?php //} ?>
                <?php //} //END foreach ?>
                <?php } //END if ?>
                <?php }//END foreach decision?>
                <?php }//END if ?>

                <?php }//END foreach($suggestions[$response_id] as $suggestion_id => $suggestion) ?>
                <?php }//END if ?>

                <?php }//END foreach($responses[$question_id] as $response_id => $response) ?>
                <?php }//END if ?>
            </td>
        </tr>
        <?php }//END if($question['type'] == 'text') ?>
        <?php }//END foreach($questions as $question_id => $question) ?>
    </table>

</body>

</html>