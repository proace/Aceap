<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Invoice</title>
<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/jquery-1.5.1.min.js"></script>
<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/jquery-ui-1.8.4.custom.min.js"></script>

<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/jquery-ui-1.8.21.custom.min.js"></script>
<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/invoice_tablet_overview_pooja.js?time=<?= time();?>"></script>
<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/eff_calculator.js"></script>
<link rel="stylesheet" type="text/css" media="all" href="<?=ROOT_URL;?>/app/webroot/css/ui-smooth/jquery-ui-1.8.21.custom.css" />
<link rel="stylesheet" type="text/css" media="all" href="<?=ROOT_URL;?>/app/webroot/css/ui-smooth/jquery-ui-1.8.13.custom.css" />
<link href="<?=ROOT_URL;?>/app/webroot/new-dialler-css/layout.css" rel="stylesheet" type="text/css">
<link href="<?=ROOT_URL;?>/app/webroot/new-dialler-css/media-queries.css" rel="stylesheet" type="text/css">
<link type="text/css" href="<?=ROOT_URL;?>/app/webroot/css/overcast/jquery-ui-1.8.4.custom.css" rel="stylesheet" />

<link rel="stylesheet" type="text/css" media="all" href="<?=ROOT_URL;?>/app/webroot/css/invoice_tablet.css" />
<link href="<?=ROOT_URL;?>/app/webroot/new-dialler-css/font-awesome.css" rel="stylesheet" type="text/css">

<style type="text/css">
.overBtn{
    padding: 5px;
    margin-bottom: 5px;
}
#timeinbx{
    width: 7%;
    height: 25px;
}
.hide_element{
    display: none;
}
.order-images{
    cursor:pointer;
    height: 200px;
    width: 125px;
}
.item_table td,.item_table th {
  border: 1px solid black;
}

.item_table {
  width: 100%;
  border-collapse: collapse;
  border: 1px solid black;
} 

@media only screen and (max-width: 768px) {
 body, td, th, p{
	font-size:1em !important;
 }
 #invoice{
    margin-left: 0px;
}
    #timeinbx{
        width: 25%;
        height: 25px;
    }
}
 table.recording {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

table.recording td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}
.redColor{
 color:red;
}

</style>
</head>

<body>
    <?php
	require_once 'Mobile_Detect.php';



	$detect = new Mobile_Detect;
// Any mobile device (phones or tablets).
if ( $detect->isMobile() ) { ?>
 <style>
	ul#nav{
		display:none;
	}
 </style>
 
<?php }
	?>
<ul id="nav">
    <li><a id="jobs_link" class="buttons"><div>Jobs</div></a></li>   
    <li><a href="<?php echo BASE_URL;?>/pages/main" id="home_link" class="buttons"><div>ACESYS</div></a></li>
    <li><a id="calc_link" class="buttons"><div>Eff Calculator</div></a></li>
</ul>

<div id="invoice">
	
	<ul id="job_list">
    	<?php foreach($jobs as $job) { ?>
        <?php if($job['Order']['order_status_id'] == 5) $url = BASE_URL."/orders/invoiceTabletPrint?order_id=".$job['Order']['id'] ?>
        <?php if($job['Order']['order_status_id'] == 3) $url = "#" ?>
        <?php if($job['Order']['order_status_id'] == 1) $url = BASE_URL."/orders/invoiceTabletOverview?order_id=".$job['Order']['id'] ?>
    	<li>
        <a href="<?php echo $url;?>" class="job status<?php echo $job['Order']['order_status_id'] ?>">
        	<span><?php echo $job['Customer']['first_name'] ?> <?php echo $job['Customer']['last_name'] ?><?php echo $job['Customer']['address_street'].', '.$job['Customer']['state'].', '.$job['Customer']['city']; ?> <?php echo $job['Order']['job_time_beg'] ?> <?php echo $job['Order']['job_time_end'] ?></span>            
            <div><?php echo $job['Order']['order_number'] ?></div>
            <div></div>
        </a>        
        </li>                
        <?php } ?>
    </ul>

    <?php foreach($jobs as $job) { ?>
    <?php if($job['Order']['id'] == $order_id) { ?>
    <div class="header">
    <h1>#<?php echo $job['Order']['order_number'] ?> - <?php echo $job['Type']['name'] ?></h1>
    <table>
        <tr>
            <td>Firs name:</td>
            <td><?php echo $job['Customer']['first_name'] ?></td>
        </tr>
        <tr>
            <td>Last name:</td>
            <td><?php echo $job['Customer']['last_name'] ?></td>
        </tr>
        <tr>
            <td>Email:</td>
            <td><?php echo $job['Customer']['email'] ?></td>
        </tr>
        <tr>
            <td>Unit number:</td>
            <td><?php echo $job['Customer']['address_unit'] ?></td>
        </tr>
        <tr>
            <td>Street number:</td>
            <td><?php echo $job['Customer']['address_street_number'] ?></td>
        </tr>
        <tr>
            <td>Street name:</td>
            <td><?php echo $job['Customer']['address_street'] ?></td>
        </tr>
        <tr>
            <td>City:</td>
            <td><?php echo $job['Customer']['city'] ?></td>
        </tr>
        <tr>
            <td>Postal code:</td>
            <td><?php echo $job['Customer']['postal_code'] ?></td>
        </tr>
        <tr>
            <td>Cell Phone:</td>
            <td><?php echo $job['Customer']['cell_phone'] ?></td>
        </tr>
        <tr>
            <td>Home Phone:</td>
            <td><?php echo $job['Customer']['phone'] ?></td>
        </tr>
    </table>
    <p><a href="<?php echo $HtmlAssist->getOrderGoogleMap($job['Customer'])?>" target="_blank">
		<?php echo $job['Customer']['address'] ?> <?php echo $job['Customer']['city'] ?> <?php echo $job['Customer']['postal_code'] ?>
        </a>
    </p>
    <?php if(!empty($recordingName)){?>
         <img src="/acesys/app/webroot/img/voice.jpg" style="width:27px;height:32px">
        <audio controls><source src="<?echo ADUIO_REC_PATH.$recordingName?>" type="audio/wav"></audio></td></tr>    
    <?php }?>
   
	<?php if ( ($job['Customer']['card_number']!='') && ($job['Customer']['card_exp']!='0000-00-00') ) { ?>
		<p><b style="color:red">Member</b> (Card # <?=$job['Customer']['card_number']?> &nbsp;&nbsp; Exp. Date: <?=date("d M Y", strtotime($job['Customer']['card_exp'])); ?>)</p>
	<?php } ?>

    </div> 
    <div id="overview_div">
    <form action="<?php echo BASE_URL ?>/orders/invoiceTabletOverviewSave" method="post">
        <?php echo $html->input('Invoice/order_id', array('type'=>'hidden', 'value'=>$job['Order']['id'])); ?>
        <?php echo $html->input('Invoice/order_type_id', array('type'=>'hidden', 'value'=>$job['Order']['order_type_id'])); ?>
        <?php echo $html->input('Invoice/customer_id', array('type'=>'hidden', 'value'=>$job['Customer']['id'])); ?>
        <?php echo $html->input('Invoice/phone', array('type'=>'hidden', 'value'=>$job['Customer']['phone'])); ?>
    	        
        <div id="notes_table">
        <h3>Booking</h3>
        <table class="item_table office">
        	<tr>
            	<th class="item_name">Name</th>
                <th>Discount</th>
                <th>Payable</th>                
            </tr>
            
        	<?php foreach($job['BookingItem'] as $item) { ?>
            <tbody>
            <?php if($item['class'] == 0) { ?>
        	<tr>
            	<td class="left"><?php echo $item['name'] ?></td>
                <td class="right"><?php echo $item['discount'] ?></td>                                
                <td class="right"><?php echo number_format(round(($item['price'] * $item['quantity']) - $item['discount'] + $item['addition'],2), 2, '.', '') ?></td>
            </tr>
            <?php } ?>
            </tbody>            
            <?php } ?>
        </table>
        
        <h3>Office Notes</h3>
        <table>
            <tbody id="previous_notes">
                <?php foreach($notes as $note) { ?>
                <tr class="<?php echo $note['row_class'] ?>">
                    <td class="note_type <?php echo $note['note_type_name'] ?>" title="<?php echo $note['author_name'] ?> <?php echo $note['note_date'] ?>"><?php echo $note['note_type_name'] ?></td>
                    <td class="note_urgency <?php echo $note['urgency_name'] ?>"><img src="<?php echo ROOT_URL ?>/app/webroot/img<?php echo $note['urgency_image'] ?>" title="<?php echo $note['urgency_name'] ?>" /></td>
                    <td class="note_message"><?php echo $note['message'] ?></td>                                    
                </tr>                                    
                <?php } //END foreach notes ?>
            </tbody>            
        </table>
        </td>
        </div>
        
        <div id="questions_table">
        <h3>Questions</h3>
        <table class="questions_table">        
        <?php foreach($job['OrdersQuestions'] as $question) { ?> 
            <?php if($question['question'] != "48 hrs notice:") { ?>       
            <tr>
            	<td class="question_text"><?php echo $question['question'] ?></td>
                <td class="answer_text"><?php echo $question['answers'] ?></td>
                <td class="answer_text"><?php echo $question['local_answer'] ?></td>
            </tr>            
            <?php } ?>
        <?php } ?>
        </table>
        </div>
        <h3>History</h3>
        <div>            
            <input type="button" class="overBtn" id="show_history" value="Show History" />
            <input type="button"  id="hide_history" value="Hide History" class="hide_element overBtn" />
        </div>
        <div id="JobHistoryWorking">Loading...</div>
        <div id="JobHistory" class="hide_element"></div>
        <div>
            <input type="button" class="overBtn" id="show_images" value="Show Images" />
            <input type="button" id="hide_images" value="Hide Images"  class="hide_element overBtn"/>
        </div>
         <div>
          <?php
          if(empty($callRecordings)|| count(callRecordings)==0){
          $class="";
          }
          else {
          $class="redColor";
          }
          ?>
          
            <input type="button"  class="overBtn <?= $class ?>" id="show_recording" value="Recording" />
            <input type="button" id="hide_recording" value="Hide Recording"  class="hide_element overBtn"/>
        </div>
        
        

        <table style="width:100%;padding-top:25px;" id="all_images" class="hide_element">
           <tr>
                <?php foreach ($allImages as $key => $value) {?>
            <td>
                <div style="position: relative; padding:5px;">
                 <?php
                 if(!empty($value['label'])){ ?>
                 
                  <div style="max-width:150px;word-wrap:break-word"><b>Note:<?php echo $value['label'] ?></b></div>
                 <?php
                  
                 }
                 
                  if(!empty($value['date'])){ ?>
                 
                  <div><b>Date:<?php echo $value['date'] ?></b></div>
                 <?php
                  
                 }
                 ?>
                  
                 
                 
                   <?php if($value['extension'] == 'pdf') {?>
                       
                          <img class="show-pdf-image" src="<?=ROOT_URL?>/app/webroot/img/doc_pdf.png" data-doc_lnk="<?php echo '/acesys/upload_photos/'.$value['image_name'];?>" style="height: 70px;width: 70px;"  >
                    <?php } else {?>
                       
                        <img id="" class="invoice-openImg order-images" src="<?php echo ROOT_URL.'/upload_photos/'.$value['image_name'];?>">
                    <?php } ?>
                </div>
            </td>
            
        <?php } ?>

           </tr>

            <!-- <tr>
             <?php foreach ($allImages as $key => $value) {?>
                <td>
                    <div style="position: relative; padding:0; width: 30px;"> 
                            <img id="" class="invoice-openImg" src="<?php echo ROOT_URL.'/upload_photos/'.$value;?>" style="max-height:28px;height:auto;cursor:pointer;">
                    </div>
                </td>
            <?php } ?>
            </tr> -->
        </table>
        
        
        <table class="recording hide_element">
  <tr>
    <th>Date</th>
    <th>Time</th>
    <th>File</th>
  </tr>
  

	 <?php
  
	 //print_r($recordings);
		 foreach($callRecordings as $recording) { 
		 	 $recName = $recording["media_name"];
//			 $chunks = str_split($recName, 2);
////Convert array to string.  Each element separated by the given separator.
//$result = implode(':', $chunks);

$result = substr($recName, 0, 4);

$result1 = substr($recName, 4, 4);

$result2 = substr($recName, 8, 6);

$chunks1 = str_split($result1, 2);
//Convert array to string.  Each element separated by the given separator.
$result3 = implode('-', $chunks1);

$chunks2 = str_split($result2, 2);
//Convert array to string.  Each element separated by the given separator.
$result4 = implode(':', $chunks2);

$result5 = implode('/',$chunks1); ?>

<tr>
    <td><?= $result."/".$result5 ?></td>
    <td><?= $result4 ?></td>
    <td><audio controls><source src="<?php echo  ADUIO_REC_PATH.$recName ?>" type="audio/wav"></audio></td>
  </tr>
  

<?php


		 	 //echo '<tr><td href="javascript:void(0)"><span>'.$result2.'</span><audio controls><source src="'.ADUIO_REC_PATH.$recName.'" type="audio/wav"></audio></td></tr>';
		  }?>
</table>
        <!--<div class="time_log">
        	Time In:
            <?php $begin = explode(":", $order['Order']['fact_job_beg']); ?>
			<?php echo $html->hourOptionTag('Order/fact_job_beg', null, 1, $begin[0]); ?>
			:
			<?php echo $html->minuteOptionTag('Order/fact_job_beg', null, $begin[1], null, null, false); ?>
        </div>-->     
        
        <!--<h3>Time In</h3>
        <input type="text" name="timeIn" id="timeinbx" value="<?= $timein; ?>">-->   
       <!--  <?php echo $order['Order']['fact_job_beg']=='00:00:00'?'Job not started. Time in will be recorded when the "Edit Job Questions" is clicked.':$order['Order']['fact_job_beg'] ?> -->
        <!--<?php echo $html->input('Order/fact_job_beg', array('type'=>'hidden', 'value'=>$job['Order']['fact_job_beg'])); ?>
        -->
        
		<div class="next_div">
        	<input type="submit" class="next_submit" value="Edit Job Questions" />
        </div>
    </form>    
    </div>
    <?php } ?>
    <?php } ?>
	
    <!--<pre><?php //print_r($jobs) ?></pre>-->
</div>

<div id="calc_dialog">
<table>
	<tr>
    	<td>
        	<h3>Yearly Cost</h3>
        	<table>
            	<tr>
                	<td colspan="3"><div class="number_display" id="cost">0</div></td>
                </tr>
                <tr>
                	<td><input type="button" value="7" class="calc_digits"></td>
                    <td><input type="button" value="8" class="calc_digits"></td>
                    <td><input type="button" value="9" class="calc_digits"></td>
                </tr>
                <tr>
                	<td><input type="button" value="4" class="calc_digits"></td>
                    <td><input type="button" value="5" class="calc_digits"></td>
                    <td><input type="button" value="6" class="calc_digits"></td>
                </tr>
                <tr>
                	<td><input type="button" value="1" class="calc_digits"></td>
                    <td><input type="button" value="2" class="calc_digits"></td>
                    <td><input type="button" value="3" class="calc_digits"></td>
                </tr>
                <tr>
                	<td><input type="button" value="0" class="calc_digits"></td>
                    <!--<td><input type="button" value="." class="calc_dot"></td>-->
                    <td colspan="2" class="right"><input type="button" value="clear" class="calc_clear"></td>
                </tr>
            </table>
            <h3>Old Furnace %</h3>
        	<table>
            	<tr>
                	<td><div class="number_display" id="old_eff">0</div></td>
                </tr>
                <tr>
                	<td><input type="button" value="60" class="calc_percent"></td>
                </tr>
                <tr>
                    <td><input type="button" value="70" class="calc_percent"></td>
                </tr>
                <tr>
                    <td><input type="button" value="80" class="calc_percent"></td>
                </tr>
                                
            </table>
        </td>
        <td style="position:relative">
        	<div id="old_scale">Old:<span id="old_cost"></span></div>
            <div id="new1_scale">92:<span id="new1_cost"></span></div>
            <div id="new2_scale">95:<span id="new2_cost"></span></div>
        </td>
    </tr>
</table>
</div>
<div class="invoice-img-enlarge" title="Photo" style="display: none">
    <img class="rotate-image" src="<?=$imgPath?>" style="width:100%;">
    <?php echo $this->element('image_rotate'); ?>
    <button class="w3-btn"> <a href="#" onclick="this.href =" download>Download</a> </button>
</div>
<div class="invoice-pdf-enlarge" title="Photo" style="display: none">
    <div id="doc-modal" style="width: 100%, height:100%"></div>
</div>
<?php echo $this->element('tech_footer'); ?>
<script>
 $('#show_recording').live('click',function(){
 $('table.recording').show();
 $(this).hide();
 $('#hide_recording').show();
  });
 
 $('#hide_recording').live('click',function(){
 $('table.recording').hide();
 $(this).hide();
 $('#show_recording').show();
  });
 
</script>
</body>
</html>