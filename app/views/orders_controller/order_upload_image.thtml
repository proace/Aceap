<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Invoice</title>
<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/jquery-ui.min.js"></script>

<!-- <script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/jquery-ui-1.8.21.custom.min.js"></script> -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.2.0/dropzone.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.2.0/dropzone.css" rel="stylesheet" type="text/css">
<link href="<?=ROOT_URL;?>/app/webroot/css/jquery-ui.min.css" rel="stylesheet" type="text/css">
<!-- <link rel="stylesheet" type="text/css" media="all" href="<?=ROOT_URL;?>/app/webroot/css/ui-smooth/jquery-ui-1.8.13.custom.css" /> -->
<link href="<?=ROOT_URL;?>/app/webroot/css/jquery-ui.min.css" rel="stylesheet" type="text/css">
<link href="<?=ROOT_URL;?>/app/webroot/new-dialler-css/font-awesome.css" rel="stylesheet" type="text/css">


<form id="imageUploadForm" action="<?=BASE_URL;?>/orders/saveTechImages/1" class="dropzone">
      <input type="hidden" name="orderId" id="order-image-id" value="<?=$oid?>">
      <input type="hidden" name="customerId" id="order-cust-id" value="<?=$cusid?>">
    </form>
      <button id="uploaderBtn" type="button" class="btn btn-primary">Save</button>
      <button type="button" class="btn btn-default " id="close-upload-btn" data-dismiss="modal">Remove images</button>

<script type="text/javascript">
     Dropzone.autoDiscover = false;

    // if (document.getElementById('DropzoneElementId')) {
      var myAwesomeDropzone = new Dropzone("form#imageUploadForm", {

        autoProcessQueue: false,
        maxFiles: 10,
        uploadMultiple: true,
        dictDefaultMessage:"Upload 5 images at a time.",
        
        init: function() {

            var submitButton = document.querySelector("#uploaderBtn")
            var closeButton = document.querySelector("#close-upload-btn")
                myDropzone = this; // closure

            submitButton.addEventListener("click", function() {
                myDropzone.processQueue(); // Tell Dropzone to process all queued files.
            });

            closeButton.addEventListener("click", function() {
                myDropzone.removeAllFiles(); // Tell Dropzone to process all queued files.
            });

            // You might want to show the submit button only when 
            // files are dropped here:
            this.on("addedfile", function(file) {
                 // Create the remove button
                var removeButton = Dropzone.createElement("<div class='remove-upload-img'><button class='btn btn-link '><i class='fa fa-times'></i></button></div>");

                var _this = this;

                removeButton.addEventListener("click", function(e) {

                  e.preventDefault();
                  e.stopPropagation();

                  _this.removeFile(file);
                });

                file.previewElement.appendChild(removeButton);
            });

            this.on("success", function(file, responseText) {
                myDropzone.removeAllFiles(); 
                $('#close-upload-btn').trigger('click');
                opener.location.reload();
                window.close();
                // $('#subcat_images_box').dialog('close');
            });
        }
    });
  </script>