<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Invoice</title>
<!--<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
<meta name="apple-mobile-web-app-capable" content="yes">-->
<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/jquery-1.5.1.min.js"></script>
<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/jquery-ui-1.8.21.custom.min.js"></script>
<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/invoice_tablet_questions.js"></script>
<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/eff_calculator.js"></script>
<link rel="stylesheet" type="text/css" media="all" href="<?=ROOT_URL;?>/app/webroot/css/ui-smooth/jquery-ui-1.8.21.custom.css" />
<link rel="stylesheet" type="text/css" media="all" href="<?=ROOT_URL;?>/app/webroot/css/invoice_tablet.css" />
<style>
body {
	font-family:Arial, Helvetica, sans-serif;
	font-size:12px;	
}

.hide {
	display:none;	
}

.rank {
	width:30px;
	text-align:right;
}

.value {
	width:200px;	
}

.response {
	width:200px;
}

.suggestion {
	width:200px;
}

.decision {
	width:200px;
}

.delete_box {
	background-color:#C00;
	color:#F93;
	padding: 4px 1px 2px;
	border-radius: 5px;
}

.notify_box {
	background-color:#090;
	color:#9F0;
	padding: 4px 1px 2px;
	border-radius: 5px;
}

select {
	width:200px;
}

input[type=text] {
	width:200px;	
}

#questions_template {
	border:1px solid #CCC;
	border-collapse: collapse;
}

#questions_template th {
	background-color:#ccc;
	padding:7px;	
}

#questions_template .even_row {
	background-color:#eee;	
}

#questions_template td {
	padding:2px;
}

</style>
</head>
<?php $is_selected = ""; ?>
<body>
<ul id="nav">
    <li><a id="jobs_link" class="buttons"><div>Jobs</div></a></li>
    <li><a href="<?php echo BASE_URL;?>/pages/main" id="home_link" class="buttons"><div>ACESYS</div></a></li>
    <li><a id="calc_link" class="buttons"><div>Eff Calculator</div></a></li>
</ul>

<div id="invoice">
	
	<ul id="job_list">
    	<?php foreach($jobs as $job) { ?>
        <?php if($job['Order']['order_status_id'] == 5) $url = BASE_URL."/orders/invoiceTabletPrint?order_id=".$job['Order']['id'] ?>
        <?php if($job['Order']['order_status_id'] == 3) $url = "#" ?>
        <?php if($job['Order']['order_status_id'] == 1) $url = BASE_URL."/orders/invoiceTabletOverview?order_id=".$job['Order']['id'] ?>
    	<li>
        <a href="<?php echo $url;?>" class="job status<?php echo $job['Order']['order_status_id'] ?>">
        	<span><?php echo $job['Customer']['first_name'] ?> <?php echo $job['Customer']['last_name'] ?> <?php echo $job['Customer']['address_street'].', '.$job['Customer']['state'].', '.$job['Customer']['city']; ?><?php echo $job['Order']['job_time_beg'] ?> <?php echo $job['Order']['job_time_end'] ?></span>            
            <div><?php echo $job['Order']['order_number'] ?></div>
        </a>        
        </li>                
        <?php } ?>
    </ul>
    
    <?php $job = $this_job ?>
    <?php if($job['Order']['id'] == $order_id) { ?>
    <div class="header">
    <h1>#<?php echo $job['Order']['order_number'] ?> - <?php echo $job['Type']['name'] ?></h1>
   <table>
        <tr>
            <td>Firs name:</td>
            <td><?php echo $job['Customer']['first_name'] ?></td>
        </tr>
        <tr>
            <td>Last name:</td>
            <td><?php echo $job['Customer']['last_name'] ?></td>
        </tr>
        <tr>
            <td>Email:</td>
            <td><?php echo $job['Customer']['email'] ?></td>
        </tr>
        <tr>
            <td>Unit number:</td>
            <td><?php echo $job['Customer']['address_unit'] ?></td>
        </tr>
        <tr>
            <td>Street number:</td>
            <td><?php echo $job['Customer']['address_street_number'] ?></td>
        </tr>
        <tr>
            <td>Street name:</td>
            <td><?php echo $job['Customer']['address_street'] ?></td>
        </tr>
        <tr>
            <td>City:</td>
            <td><?php echo $job['Customer']['city'] ?></td>
        </tr>
        <tr>
            <td>Postal code:</td>
            <td><?php echo $job['Customer']['postal_code'] ?></td>
        </tr>
         <tr>
            <td>Cell Phone:</td>
            <td><?php echo $job['Customer']['cell_phone'] ?></td>
        </tr>
        <tr>
            <td>Home Phone:</td>
            <td><?php echo $job['Customer']['phone'] ?></td>
        </tr>
    </table>
    <p><a href="<?php echo $HtmlAssist->getOrderGoogleMap($job['Customer'])?>" target="_blank">
		<?php echo $job['Customer']['address'] ?> <?php echo $job['Customer']['city'] ?> <?php echo $job['Customer']['postal_code'] ?>
        </a>
    </p>
    </div>
    <div>
    <?php if($last_order['Order']['order_number'] != "") { ?>
    <h2><?php echo $last_order['Order']['order_number'] ?> - <?php echo $last_order['Type']['name'] ?></h2>
    <?php } ?>
    </div>
    <div id="overview_div">   
    <!--<?php echo $job['Order']['job_date'] ?>-->
    <?php if($job['Order']['order_status_id'] == 8 && ($job['Order']['job_date'] == '0000-00-00' || $job['Order']['job_date'] == '')) { ?>
    	<h3 id="question_opener">Do you want to answers the Questions?
        	&nbsp;&nbsp;&nbsp;
    		<input type="button" class="next_submit" id="open_questions" value="Yes" style="width:100px;height:50px;" />
            &nbsp;&nbsp;&nbsp;
            <input type="button" class="next_submit" id="skip_to_comments" value="No" style="width:100px;height:50px;" />
        </h3>
    <?php } ?>
    <form id="questions_form" action="<?php echo BASE_URL ?>/orders/saveInvoiceTabletQuestions" method="post" <?php if($job['Order']['order_status_id'] == 8 && ($job['Order']['job_date'] == '0000-00-00' || $job['Order']['job_date'] == '')) { ?>style="display:none;"<?php } ?>>
    <?php echo $html->input('Invoice/order_id', array('type'=>'hidden', 'value'=>$job['Order']['id'])); ?>    
    <?php echo $html->input('Invoice/order_type_id', array('type'=>'hidden', 'value'=>$job['Order']['order_type_id'])); ?>
    <?php echo $html->input('Invoice/order_status_id', array('type'=>'hidden', 'value'=>$job['Order']['order_status_id'])); ?>
    <?php echo $html->input('Invoice/last_order_id', array('type'=>'hidden', 'value'=>$last_order['Order']['id'])); ?>
        <table id="questions_template">
            <tr>
                <th>#</th>
                <th>Questions</th>
                <th>Responses</th>
                <th>Suggestions</th>
                <th>Decisions</th>
                <th></th>
            </tr>
            <?php $row = ""; $index = 1;?>
            <?php foreach($questions as $question_id => $question) { ?>
            <?php $row = $index++%2==0?"even_row":"";?>
            <?php if($question['type'] == 'dropdown') { ?>
            <tr>
                <td class="<?php echo $row ?>"><?php echo $question['rank'] ?></td>
                <td class="<?php echo $row ?>"><?php echo $question['value'] ?></td>
                <td class="<?php echo $row ?>">
                <?php if(count($responses[$question_id]) > 0) { ?>
                <input type="hidden" class="question_id" value="<?php echo $question_id ?>" />
                <select class="responses rank<?php echo $question['rank'] ?> required" name="data[Template][<?php echo $question_id ?>][response_id]">
                    <option value="">?</option>
                    <?php foreach($responses[$question_id] as $response_id => $response) { ?>
                    <?php $is_selected = isset($working_answers[$question_id]['response_id'])&&$response_id==$working_answers[$question_id]['response_id']?'selected="selected"':isset($carried_answers[$question_id]['response_id'])&&$response_id==$carried_answers[$question_id]['response_id']?'selected="selected"':'' ?>
                    
                    <option <?php echo $is_selected ?> value="<?php echo $response_id ?>"><?php echo $response['value'] ?></option>                    
                    <?php }//END foreach($responses[$question_id] as $response_id => $response) ?>
                </select>
                <?php }//END if ?>
                </td>
                <td class="<?php echo $row ?>">
                <?php if(count($responses[$question_id]) > 0) { ?>        
                    <?php foreach($responses[$question_id] as $response_id => $response) { ?>
                    
                    <?php if(count($suggestions[$response_id]) > 0) { ?>
                    <input type="hidden" class="response_id" value="<?php echo $response_id ?>" />                    
                    <?php 
						if(isset($working_answers[$question_id]['suggestion_id']) && isset($working_answers[$question_id]['response_id']) && $response_id == $working_answers[$question_id]['response_id']) { 
							$is_hidden = "";
							$is_disabled = "";
						} else {
							//$is_hidden = "hide";
							//$is_disabled = 'disabled="disabled"';
							if(isset($carried_answers[$question_id]['suggestion_id']) && isset($carried_answers[$question_id]['response_id']) && $response_id == $carried_answers[$question_id]['response_id']) { 
								$is_hidden = "";
								$is_disabled = "";
							} else {
								$is_hidden = "hide";
								$is_disabled = 'disabled="disabled"';
							}
						}
					?>
                    <select class="suggestions <?php echo $is_hidden ?> q<?php echo $question_id ?> required" id="r<?php echo $response_id ?>" name="data[Template][<?php echo $question_id ?>][suggestion_id]" <?php echo $is_disabled ?>>
                        <option value="">?</option>
                        <?php foreach($suggestions[$response_id] as $suggestion_id => $suggestion) { ?>
                        <?php $is_selected = isset($working_answers[$question_id]['suggestion_id'])&&$suggestion_id==$working_answers[$question_id]['suggestion_id']?'selected="selected"':isset($carried_answers[$question_id]['suggestion_id'])&&$suggestion_id==$carried_answers[$question_id]['suggestion_id']?'selected="selected"':'' ?>                        
                        <option <?php echo $is_selected ?> value="<?php echo $suggestion_id ?>"><?php echo $suggestion['value'] ?></option>
                        <?php }//END foreach($suggestions[$response_id] as $suggestion_id => $suggestion) ?>
                    </select>
                    <?php }//END if ?>
                        
                    <?php }//END foreach($responses[$question_id] as $response_id => $response) ?>
                <?php }//END if ?>
                </td>
                <td class="<?php echo $row ?>">
                <?php if(count($responses[$question_id]) > 0) { ?>        
                    <?php foreach($responses[$question_id] as $response_id => $response) { ?>
                    
                    <?php if(count($suggestions[$response_id]) > 0) { ?>            
                        <?php foreach($suggestions[$response_id] as $suggestion_id => $suggestion) { ?>
                        
                        <?php if(count($decisions[$suggestion_id]) > 0) { ?>
                        <input type="hidden" class="suggestion_id" value="<?php echo $suggestion_id ?>" />
                        <?php 
							if(isset($working_answers[$question_id]['decision_id']) && isset($working_answers[$question_id]['suggestion_id']) && $suggestion_id == $working_answers[$question_id]['suggestion_id']) { 
								$is_hidden = "";
								$is_disabled = "";
							} else {
								//$is_hidden = "hide";
								//$is_disabled = 'disabled="disabled"';
								if(isset($carried_answers[$question_id]['decision_id']) && isset($carried_answers[$question_id]['suggestion_id']) && $suggestion_id == $carried_answers[$question_id]['suggestion_id']) { 
									$is_hidden = "";
									$is_disabled = "";
								} else {
									$is_hidden = "hide";
									$is_disabled = 'disabled="disabled"';
								}
							}
						?>
                        <select class="decisions <?php echo $is_hidden ?> q<?php echo $question_id ?> r<?php echo $response_id ?> required" id="s<?php echo $suggestion_id ?>" name="data[Template][<?php echo $question_id ?>][decision_id]" <?php echo $is_disabled ?>>
                            <option value="">?</option>
                            <?php foreach($decisions[$suggestion_id] as $decision_id => $decision) { ?>
                            <?php $is_selected = isset($working_answers[$question_id]['decision_id'])&&$decision_id==$working_answers[$question_id]['decision_id']?'selected="selected"':isset($carried_answers[$question_id]['decision_id'])&&$decision_id==$carried_answers[$question_id]['decision_id']?'selected="selected"':'' ?>
                            <option <?php echo $is_selected ?> value="<?php echo $decision_id ?>"><?php echo $decision['value'] ?></option>
                            <?php }//END foreach($decisions[$suggestion_id] as $decision_id => $decision) ?>
                        </select>	
                        <?php }//END if ?>                        
                        
						<?php }//END foreach($suggestions[$response_id] as $suggestion_id => $suggestion) ?>
                    <?php }//END if ?>
                    
                    <?php }//END foreach($responses[$question_id] as $response_id => $response) ?>
                <?php }//END if ?>
                
                </td> 
                <td class="error_indicator <?php echo $row ?>"></td>     
            </tr>
            <?php }//END if($question['type'] == 'dropdown') ?>
            <?php if($question['type'] == 'text') { ?>
            <tr>
                <td class="<?php echo $row ?>"><?php echo $question['rank'] ?></td>
                <td class="<?php echo $row ?>"><?php echo $question['value'] ?></td>
                <td class="<?php echo $row ?>">
                <?php if(count($responses[$question_id]) > 0) { ?>
                <input type="hidden" class="question_id" value="<?php echo $question_id ?>" />                
                <input type="text" class="text_response rank<?php echo $question['rank'] ?> required" name="data[Template][<?php echo $question_id ?>][response_text]" value="<?php echo isset($working_answers[$question_id]['response_text'])?$working_answers[$question_id]['response_text']:isset($carried_answers[$question_id]['response_text'])?$carried_answers[$question_id]['response_text']:'' ?>" />       
                <div class="response_codes">
                    <?php foreach($responses[$question_id] as $response_id => $response) { ?>
                    <div class="code">
                        <input type="hidden" class="rank" value="<?php echo $question['rank'] ?>" />
                        <input type="hidden" class="id" value="<?php echo $response_id ?>" />                
                        <input type="hidden" class="operation_id" value="<?php echo $response['operation_id'] ?>" />
                        <input type="hidden" class="which_id" value="<?php echo $response['which_id'] ?>" />
                        <input type="hidden" class="value" value="<?php echo $response['value'] ?>" />
                    </div>
                    <?php }//END foreach($responses[$question_id] as $response_id => $response) ?>          
                </div>
                <?php }//END if ?>
                </td>
                <td class="<?php echo $row ?>">
                <?php if(count($responses[$question_id]) > 0) { ?>        
                    <?php foreach($responses[$question_id] as $response_id => $response) { ?>
                    
                    <?php if(count($suggestions[$response_id]) > 0) { ?>                    
                    <input type="hidden" class="response_id" value="<?php echo $response_id ?>" />
                    <select class="suggestions hide q<?php echo $question_id ?> required" id="r<?php echo $response_id ?>" name="data[Template][<?php echo $question_id ?>][suggestion_id]" disabled="disabled">
                        <option value="">?</option>
                        <?php foreach($suggestions[$response_id] as $suggestion_id => $suggestion) { ?>
                        <?php $is_selected = isset($working_answers[$question_id]['suggestion_id'])&&$suggestion_id==$working_answers[$question_id]['suggestion_id']?'selected="selected"':isset($carried_answers[$question_id]['suggestion_id'])&&$suggestion_id==$carried_answers[$question_id]['suggestion_id']?'selected="selected"':'' ?>
                        <option <?php echo $is_selected ?> value="<?php echo $suggestion_id ?>"><?php echo $suggestion['value'] ?></option>
                        <?php }//END foreach($suggestions[$response_id] as $suggestion_id => $suggestion) ?>
                    </select>
                    <?php }//END if ?>
                        
                    <?php }//END foreach($responses[$question_id] as $response_id => $response) ?>
                <?php }//END if ?>
                </td>
                <td class="<?php echo $row ?>">
                <?php if(count($responses[$question_id]) > 0) { ?>        
                    <?php foreach($responses[$question_id] as $response_id => $response) { ?>
                    
                    <?php if(count($suggestions[$response_id]) > 0) { ?>            
                        <?php foreach($suggestions[$response_id] as $suggestion_id => $suggestion) { ?>
                        
                        <?php if(count($decisions[$suggestion_id]) > 0) { ?>
                        <input type="hidden" class="suggestion_id" value="<?php echo $suggestion_id ?>" />                        
                        <select class="decisions hide q<?php echo $question_id ?> r<?php echo $response_id ?> required" id="s<?php echo $suggestion_id ?>" name="data[Template][<?php echo $question_id ?>][decision_id]" disabled="disabled">
                            <option value="">?</option>
                            <?php foreach($decisions[$suggestion_id] as $decision_id => $decision) { ?>
                            <?php $is_selected = isset($working_answers[$question_id]['decision_id'])&&$decision_id==$working_answers[$question_id]['decision_id']?'selected="selected"':isset($carried_answers[$question_id]['decision_id'])&&$decision_id==$carried_answers[$question_id]['decision_id']?'selected="selected"':'' ?>
                            <option <?php echo $is_selected ?> value="<?php echo $decision_id ?>"><?php echo $decision['value'] ?></option>
                            <?php }//END foreach($decisions[$suggestion_id] as $decision_id => $decision) ?>
                        </select>	
                        <?php }//END if ?>
                        
                        <?php }//END foreach($suggestions[$response_id] as $suggestion_id => $suggestion) ?>
                    <?php }//END if ?>                        
                    <?php }//END foreach($responses[$question_id] as $response_id => $response) ?>
                <?php }//END if ?>                
                </td>
                <td class="error_indicator <?php echo $row ?>"></td> 
            </tr>
            <?php }//END if($question['type'] == 'text') ?>
            <?php }//END foreach($questions as $question_id => $question) ?>
        </table>    
    	<div class="next_div">        	
            <input type="button" class="next_submit" id="test_required" value="Save Questions" />              
        </div>
    </form>    
    </div>
    <?php } ?>    
	
    <!--<pre><?php print_r($last_order) ?></pre>-->
</div>

<div id="calc_dialog">
<table>
	<tr>
    	<td>
        	<h3>Yearly Cost</h3>
        	<table>
            	<tr>
                	<td colspan="3"><div class="number_display" id="cost">0</div></td>
                </tr>
                <tr>
                	<td><input type="button" value="7" class="calc_digits"></td>
                    <td><input type="button" value="8" class="calc_digits"></td>
                    <td><input type="button" value="9" class="calc_digits"></td>
                </tr>
                <tr>
                	<td><input type="button" value="4" class="calc_digits"></td>
                    <td><input type="button" value="5" class="calc_digits"></td>
                    <td><input type="button" value="6" class="calc_digits"></td>
                </tr>
                <tr>
                	<td><input type="button" value="1" class="calc_digits"></td>
                    <td><input type="button" value="2" class="calc_digits"></td>
                    <td><input type="button" value="3" class="calc_digits"></td>
                </tr>
                <tr>
                	<td><input type="button" value="0" class="calc_digits"></td>
                    <!--<td><input type="button" value="." class="calc_dot"></td>-->
                    <td colspan="2" class="right"><input type="button" value="clear" class="calc_clear"></td>
                </tr>
            </table>
            <h3>Old Furnace %</h3>
        	<table>
            	<tr>
                	<td><div class="number_display" id="old_eff">0</div></td>
                </tr>
                <tr>
                	<td><input type="button" value="60" class="calc_percent"></td>
                </tr>
                <tr>
                    <td><input type="button" value="70" class="calc_percent"></td>
                </tr>
                <tr>
                    <td><input type="button" value="80" class="calc_percent"></td>
                </tr>
                                
            </table>
        </td>
        <td style="position:relative">
        	<div id="old_scale">Old:<span id="old_cost"></span></div>
            <div id="new1_scale">92:<span id="new1_cost"></span></div>
            <div id="new2_scale">95:<span id="new2_cost"></span></div>
        </td>
    </tr>
</table>
</div>
<pre>
<?php //print_r($working_answers) ?>
</pre>
</body>
</html>