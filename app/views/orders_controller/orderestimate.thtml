<html>
<head>
<title>Send Email</title>
<style>
	
	html, body {
		background-color: #ccc;
		margin: 0;
		padding: 0;
	}
	body > .container {
		width: 1200px;
		height: auto;
		margin: 0 auto;
		background-color: #fff;
		margin-top: 20px;
	}
	h4 {
		width: 100%;
		border-bottom: solid 1px #ccc;
		padding-bottom: 10px;
	}
	form {
		margin: 0 auto;
	}
	table {
		/*min-width: 400px;
		text-align: left;
		margin-bottom: 20px;*/
	}
	table th {
		width:80px;
		color: #346b01;
	}
	table input {
		width: 290px;
	}
	.border {
		width: 600px;
		border-bottom: solid 1px #aaa;
	}
	.border > table {
		margin-bottom: 10px;
	}
	p{
		font-size: 11px;
	}
	input.email {
    width: 161px;
    padding: 10px;
    margin-top: 10px;   
   }

</style>
<!-- <script src="<?php echo ROOT_URL; ?>/app/webroot/js/jquery.js"></script>
<script src="<?php echo ROOT_URL; ?>/app/webroot/js/tinymce/tinymce.min.js"></script> -->


<!-- <script language="JavaScript" src="<?=ROOT_URL;?>/app/webroot/js/tiny_mce/tiny_mce.js"></script>  -->
<script language="JavaScript" src="<?=ROOT_URL;?>/app/webroot/js/tinymce/tinymce.min.js"></script> 
<!-- <script src="https://cdn.tinymce.com/4/tinymce.min.js"></script> -->
<script>
	

		tinyMCE.init({
			mode: 'textareas',
			theme : "modern",
			browser_spellcheck: true,
		plugins : "code,safari,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,visualchars,nonbreaking,xhtmlxtras,template,imagemanager,filemanager, nanospell,spellchecker, link unlink, anchor, image, media",
		external_plugins: {"nanospell": "plugins/nanospell/plugin.js"},
			nanospell_server: "php", // choose "php" "asp" "asp.net" or "java"
		// Theme options
		theme_advanced_buttons1 : "save,newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,fontselect,fontsizeselect,|nanospell",
		theme_advanced_buttons2 : "cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code,|,insertdate,inserttime,preview,|,forecolor,backcolor",
		theme_advanced_buttons3 : "tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,emotions,iespell,media,advhr,|,print,|,ltr,rtl,|,fullscreen",
		theme_advanced_buttons4 : "insertlayer,moveforward,movebackward,absolute,|,styleprops,spellchecker,|,cite,abbr,acronym,del,ins,attribs,|,visualchars,nonbreaking,template,blockquote,pagebreak,|,insertfile,insertimage",
		theme_advanced_toolbar_location : "top",
		theme_advanced_toolbar_align : "left",
		theme_advanced_statusbar_location : "bottom",
		theme_advanced_resizing : true,
		
		// Example content CSS (should be your site CSS)
		content_css : "css/example.css",
		
	    convert_urls: true,
	    width: 800,
	    height: 500,
        template_external_list_url : "js/template_list.js",
		external_link_list_url : "js/link_list.js",
		external_image_list_url : "js/image_list.js",
		media_external_list_url : "js/media_list.js",
		gecko_spellcheck : true, browser_spellcheck : true
		});
	
</script>

</head>

<body>
	<form name="text_editor_form" id="text_editor_form" method="post" action="<?=BASE_URL;?>/orders/saveAndSendEstimateForOrder">

	<?php if($emptytemplate == ''){?>
			<input type="hidden" name="order_id" value="<?= $order_id ?>">
			
			<textarea id="editor1" name="editor">
				<?php echo ($template['template']?$template['template']:'') ?>
			</textarea>
			
			<input name="email" id="email" size="100" type="hidden" class="email" value="<?php echo ($orderData['Customer']['email']?$orderData['Customer']['email']:$email)?>">

			<br>
			<br>


			<?php if($preViewEstimate=="true"){ ?>
				<!-- <input name="send" onclick="sendEmail()" value="Send" class="buttons" type="button">  -->
				<input name="submit" onclick="saveTemplate()" value="Save" class="buttons" type="button"> 
			<?php }else{ ?>
				<input name="submit" onclick="saveTemplate()" value="Save" class="buttons" type="button"> 
			<?php } ?>
			<!-- window.open('<?=BASE_URL?>/orders/estimateTabletPrint?order_id='+order_id+'&type=office', '_new'); -->
			<input name="print"  type="button" onclick="printEstimate()" class="buttons" value="Print">
			

	<?php } else{ 

		echo "Estimate Template Not Found For Order! ";

	}?>
<!-- <input type="button" value="Back" onclick="history.go(-1);" class="buttons"> -->
</form>
	<script>
 	
		function printEstimate(){
			/*var x = document.getElementById("tinymce").innerHTML; */
			var x = tinyMCE.activeEditor.getContent();
			console.log(x);

			var newWindow = window.open();
			newWindow.document.write(x);
		}

		function saveTemplate() {
			var save = false;
			var data = tinyMCE.activeEditor.getContent();
			var order_id = <?= $order_id ?>;
			var fromTech = <?= $fromTech ?>;
			$.ajax({
				url: '<?=BASE_URL?>/orders/saveAndSendEstimateForOrder/',
				type: 'POST',
				data: {'editor':data,'order_id':order_id},
				success: function(data) {
					console.log("fromtech",fromTech);
					if(fromTech == 3 || fromTech== 2){
						document.location.href="techBooking?order_id=<?= $order_id ?>&from_tech_page=<?= $fromTech ?>";
					}else {
						document.location.href="editBooking?order_id=<?= $order_id ?>&from_tech_page=<?= $fromTech ?>";
					}
        			
        			/*window.location.href= "/thankyou.html";*/
    			}
			});

	    }

	    function sendEmail(){
	    	var data = tinyMCE.activeEditor.getContent();
	    	var email = document.getElementById('email').value;
	    	$.ajax({
				url: '<?=BASE_URL?>/orders/sendemailTmp/',
				type: 'POST',
				data: {'editor':data, 'email': email},
				success: function(data) {
        			document.location.href="editBooking?order_id=<?= $order_id ?>";
        			/*window.location.href= "/thankyou.html";*/
    			}
			});
	    }
	</script>
</body>
</html> 