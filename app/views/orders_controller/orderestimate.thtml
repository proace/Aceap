<html>

<head>
    <title>Send Email</title>
    <style>
        html,
        body {
            background-color: #ccc;
            margin: 0;
            padding: 0;
        }
        
        td {
            text-align: center;
        }
        
        body>.container {
            width: 1200px;
            height: auto;
            margin: 0 auto;
            background-color: #fff;
            margin-top: 20px;
        }
        
        h4 {
            width: 100%;
            border-bottom: solid 1px #ccc;
            padding-bottom: 10px;
        }
        
        form {
            margin: 0 auto;
        }
        
        table {
            /*min-width: 400px;
		text-align: left;
		margin-bottom: 20px;*/
        }
        
        table th {
            width: 80px;
            color: #346b01;
        }
        
        table input {
            width: 290px;
        }
        
        .border {
            width: 600px;
            border-bottom: solid 1px #aaa;
        }
        
        .border>table {
            margin-bottom: 10px;
        }
        
        p {
            font-size: 11px;
        }
        
        input.email {
            width: 161px;
            padding: 10px;
            margin-top: 10px;
        }
    </style>
    <!-- <script src="<?php echo ROOT_URL; ?>/app/webroot/js/jquery.js"></script>
<script src="<?php echo ROOT_URL; ?>/app/webroot/js/tinymce/tinymce.min.js"></script> -->


    <!-- <script language="JavaScript" src="<?=ROOT_URL;?>/app/webroot/js/tiny_mce/tiny_mce.js"></script>  -->
    <script language="JavaScript" src="<?=ROOT_URL;?>/app/webroot/js/tinymce/tinymce.min.js"></script>
    <!-- <script src="https://cdn.tinymce.com/4/tinymce.min.js"></script> -->
    <script>
        tinyMCE.init({
            mode: 'textareas',
            theme: "modern",
            browser_spellcheck: true,
            convert_urls: false,
            relative_urls: false,
            remove_script_host: true,
            //plugins : "code,safari,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,visualchars,nonbreaking,xhtmlxtras,template,imagemanager,filemanager, nanospell,spellchecker,responsivefilemanager, link unlink, anchor, image, media",
            plugins: "code, responsivefilemanager, table, link,  anchor, image, media",
            external_plugins: {
                "nanospell": "plugins/nanospell/plugin.js"
            },
            nanospell_server: "php", // choose "php" "asp" "asp.net" or "java"
            // Theme options
            toolbar1: "undo redo | bold italic underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | styleselect",
            toolbar2: "| responsivefilemanager | link unlink anchor | image media | forecolor backcolor  | print preview code ",
            image_advtab: true,

            external_filemanager_path: "/filemanager/",
            filemanager_title: "Acesys Filemanager",

            theme_advanced_buttons1: "save,newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,fontselect,fontsizeselect,|nanospell",
            theme_advanced_buttons2: "cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code,|,insertdate,inserttime,preview,|,forecolor,backcolor",
            theme_advanced_buttons3: "tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,emotions,iespell,media,advhr,|,print,|,ltr,rtl,|,fullscreen",
            theme_advanced_buttons4: "insertlayer,moveforward,movebackward,absolute,|,styleprops,spellchecker,|,cite,abbr,acronym,del,ins,attribs,|,visualchars,nonbreaking,template,blockquote,pagebreak,|,insertfile,insertimage",
            theme_advanced_toolbar_location: "top",
            theme_advanced_toolbar_align: "left",
            theme_advanced_statusbar_location: "bottom",
            theme_advanced_resizing: true,

            // Example content CSS (should be your site CSS)
            content_css: "css/example.css",

            // convert_urls: true,
            width: 1100,
            height: 600,
            template_external_list_url: "js/template_list.js",
            external_link_list_url: "js/link_list.js",
            external_image_list_url: "js/image_list.js",
            media_external_list_url: "js/media_list.js",
            gecko_spellcheck: true,
            browser_spellcheck: true
        });
        //		tinymce.init({
        //    selector: 'textarea#editor1',
        //    imagetools_cors_hosts: ['picsum.photos'],
        //    menubar: 'file edit view insert format tools table help',
        //    toolbar: 'undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | forecolor backcolor removeformat | pagebreak | charmap emoticons | fullscreen  preview save print | insertfile image media template link anchor codesample | ltr rtl',
        //    toolbar_sticky: true,
        //    autosave_ask_before_unload: true,
        //    autosave_interval: "30s",
        //    autosave_prefix: "{path}{query}-{id}-",
        //    autosave_restore_when_empty: false,
        //    autosave_retention: "2m",
        //    image_advtab: true,
        //    /*content_css: '//www.tiny.cloud/css/codepen.min.css',*/
        //    link_list: [
        //        { title: 'My page 1', value: 'https://www.codexworld.com' },
        //        { title: 'My page 2', value: 'https://www.xwebtools.com' }
        //    ],
        //    image_list: [
        //        { title: 'My page 1', value: 'https://www.codexworld.com' },
        //        { title: 'My page 2', value: 'https://www.xwebtools.com' }
        //    ],
        //    image_class_list: [
        //        { title: 'None', value: '' },
        //        { title: 'Some class', value: 'class-name' }
        //    ],
        //    importcss_append: true,
        //    file_picker_callback: function (callback, value, meta) {
        //        /* Provide file and text for the link dialog */
        //        if (meta.filetype === 'file') {
        //            callback('https://www.google.com/logos/google.jpg', { text: 'My text' });
        //        }
        //
        //        /* Provide image and alt text for the image dialog */
        //        if (meta.filetype === 'image') {
        //            callback('https://www.google.com/logos/google.jpg', { alt: 'My alt text' });
        //        }
        //
        //        /* Provide alternative source and posted for the media dialog */
        //        if (meta.filetype === 'media') {
        //            callback('movie.mp4', { source2: 'alt.ogg', poster: 'https://www.google.com/logos/google.jpg' });
        //        }
        //    },
        //    templates: [
        //        { title: 'New Table', description: 'creates a new table', content: '<div class="mceTmpl"><table width="98%%"  border="0" cellspacing="0" cellpadding="0"><tr><th scope="col"> </th><th scope="col"> </th></tr><tr><td> </td><td> </td></tr></table></div>' },
        //        { title: 'Starting my story', description: 'A cure for writers block', content: 'Once upon a time...' },
        //        { title: 'New list with dates', description: 'New List with dates', content: '<div class="mceTmpl"><span class="cdate">cdate</span><br /><span class="mdate">mdate</span><h2>My List</h2><ul><li></li><li></li></ul></div>' }
        //    ],
        //    template_cdate_format: '[Date Created (CDATE): %m/%d/%Y : %H:%M:%S]',
        //    template_mdate_format: '[Date Modified (MDATE): %m/%d/%Y : %H:%M:%S]',
        //    height: 600,
        //    image_caption: true,
        //    quickbars_selection_toolbar: 'bold italic | quicklink h2 h3 blockquote quickimage quicktable',
        //    noneditable_noneditable_class: "mceNonEditable",
        //    toolbar_mode: 'sliding',
        //    contextmenu: "link image imagetools table",
        //        });
    </script>

</head>

<body>
    <form name="text_editor_form" id="text_editor_form" method="post" action="<?=BASE_URL;?>/orders/saveAndSendEstimateForOrder">

        <?php if($emptytemplate == ''){?>
        <input type="hidden" name="order_id" value="<?= $order_id ?>">

        <textarea id="editor1" name="editor">
				<?php echo ($template['template']?$template['template']:'') ?>
			</textarea>

        <input name="email" id="email" size="100" type="hidden" class="email" value="<?php echo ($orderData['Customer']['email']?$orderData['Customer']['email']:$email)?>">

        <br>
        <br>


        <?php if($preViewEstimate=="true"){ ?>
        <!-- <input name="send" onclick="sendEmail()" value="Send" class="buttons" type="button">  -->
        <input name="submit" onclick="saveTemplate()" value="Save" class="buttons" type="button">
        <?php }else{ ?>
        <input name="submit" onclick="saveTemplate()" value="Save" class="buttons" type="button">
        <?php } ?>
        <!-- window.open('<?=BASE_URL?>/orders/estimateTabletPrint?order_id='+order_id+'&type=office', '_new'); -->
        <input name="print" type="button" onclick="printEstimate()" class="buttons" value="Print">


        <?php } else{

		echo "Estimate Template Not Found For Order! ";

	}?>
        <!-- <input type="button" value="Back" onclick="history.go(-1);" class="buttons"> -->
    </form>

    <script>
        function printEstimate() {
            /*var x = document.getElementById("tinymce").innerHTML; */
            var x = tinyMCE.activeEditor.getContent();
            console.log(x);

            var newWindow = window.open();
            newWindow.document.write(x);
        }

        function saveTemplate() {
            var save = false;
            var data = tinyMCE.activeEditor.getContent();
            var order_id = <?= $order_id ?>;
            var fromTech = <?= $fromTech ?>;
            $.ajax({
                url: '<?=BASE_URL?>/orders/saveAndSendEstimateForOrder/',
                type: 'POST',
                data: {
                    'editor': data,
                    'order_id': order_id
                },
                success: function(data) {
                    if (fromTech == 3 || fromTech == 2) {
                        console.log('successsful');
                        document.location.href = "techBooking?order_id=<?= $order_id ?>&customer_id=<?=$cusId ?>&from_tech_page=<?= $fromTech ?>&main_id=<?= $mainId ?>&fromTechPay=1&fromEstimate=1";
                    } else {
                        console.log('hhhh');
                        document.location.href = "editBooking?order_id=<?= $order_id ?>&from_tech_page=<?= $fromTech ?>&fromEstimate=1";
                    }

                    /*window.location.href= "/thankyou.html";*/
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    alert("Status: " + textStatus);
                    alert("Error: " + errorThrown);
                }
            });

        }

        function sendEmail() {
            var data = tinyMCE.activeEditor.getContent();
            var email = document.getElementById('email').value;
            $.ajax({
                url: '<?=BASE_URL?>/orders/sendemailTmp/',
                type: 'POST',
                data: {
                    'editor': data,
                    'email': email
                },
                success: function(data) {
                    document.location.href = "editBooking?order_id=<?= $order_id ?>";
                    /*window.location.href= "/thankyou.html";*/
                }
            });
        }
        $(document).ready(function() {
            $('.mce-title').text('file manager');
        });
    </script>
</body>

</html>