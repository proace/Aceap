<!DOCTYPE html>
<html>
<head>
	<style>
		
.search_result{
position:relative;
height:300px;
overflow:scroll;
width:120%;
display:none;
line-height:30px;
}
.search_result1{
position:relative;
height:300px;
overflow:scroll;
width:120%;
display:none;
line-height:30px;
}
textarea{
    border: ridge 2px;
    padding: 5px;
    width: 20em;
    min-height: 1em;
    overflow: auto;
}

		
	</style>
    
    <title>Send Text</title>
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/xcash/bootstrap-autocomplete@v2.3.7/dist/latest/bootstrap-autocomplete.min.js"></script>

    <script type="text/javascript">
        
   
function SendSms()
{
    console.log("innn");
    var phone_number = $('#CustomerCellPhone').val();
    var message = $('#messageVal').val();
    $.ajax({
        url: '<?=BASE_URL?>/messages/sendTextMessage',
        dataType: 'json',
        type: 'POST',
        cache: false,
        data:{phone_num:phone_number, message:message},
        success: function(data) {
			$('.search_result').show();
                window.close(); 
        }
    }); 
}
    </script>
</head>
<body>
<div id="sendAnonymousEmail" style="display: block">
        <table>
									<tr>
									<td>
									<div>	Groups: </div>
	<select class="search_select">
	<option value="">please select value</option>
		
	</select>
    <div class="search_result1"></div>
    <!--<button style="float:right;margin-top:10px;display:none;" type="button" class="btn btn-primary submit_list">Submit</button>-->
    <br><br>
									</td>	
									</tr>
            <tr>
                <td>
                  <div>Search</div><textarea id="CustomerCellPhone" name="cell_phone"></textarea>
				  <div class="search_result"></div>
                </td>
                
            </tr>
            <tr>
                <td>                
                 <div>Message</div> <textarea id="messageVal" cols="50" rows="10" placeholder="message"></textarea>
            </tr>
        </table>
        <div style="margin-left: 16%;">
        <input type="button" name="OK" value="Send" style="padding: 5px;margin-top: 5px;" onclick="SendSms();">
        <input type="button"  name="cancel" value="Cancel" onclick="window.close();" style="padding: 5px;margin-top: 5px;">
</div>
</div>
<script>
       $('#CustomerCellPhone').on('keyup', function(e) {
		
  var get_val = $(this).val();
  if (get_val.length>=3) {
	$('.search_result').show();
	$('.search_result').html(`<div style="margin: 0 auto;
    display: table;
margin-top: 10%"><img src="http://i.imgur.com/KUJoe.gif"><br>please wait loading</div>`);
    $.ajax({
        url: 'http://hvacproz.ca/acesystem2018/get_contact.php',
        
        type: 'POST',
        cache: false,
        data:{get_val:get_val},
        success: function(data) {
               console.log(data);
			   $('.search_result').show();
			   $('.search_result').html(data);
        }
    });
  }
  else {
	$('.search_result').hide();
  }
}); 
  
  $('body').on('click','.click_div',function(){
	var phone = $(this).attr('data-phone');
	$('#CustomerCellPhone').val(phone);
	$('.search_result').hide();
	
	});
 $('body').on('click','.submit_list',function(){
var get_checked = $('.select_no:checked').map(function () {  
        return this.value;
        }).get().join(",");
        $('#CustomerCellPhone').val(get_checked);
        $('.search_result').hide();
        $('.search_result1').hide();
        $('.search_select').val('');
        $(this).hide();
});

	$(document).ready(function(){
		
		$.ajax({
        url: 'http://hvacproz.ca/acesystem2018/test11.php',
        
        type: 'GET',
        cache: false,
        success: function(data) {
               $('.search_select').html(data);
        }
    });
		
		
		
		});
	
	$('.search_select').on('change',function(){
        $('.search_result1').show();
        if($(this).val()==""){
         $('.search_result1').hide();
         $('#CustomerCellPhone').val('');
         return false;
        }
	$('.search_result1').html(`<div style="margin: 0 auto;
    display: table;
margin-top: 10%"><img src="http://i.imgur.com/KUJoe.gif"><br>please wait loading</div>`);
		var value = $(this).val();
		
		$.ajax({
        url: 'http://hvacproz.ca/acesystem2018/get_search_list_result.php?url='+value,
        
        type: 'POST',
        cache: false,
        data:{get_val:value},
        success: function(data) {
             			   $('.search_result1').show();
                            $('.submit_list').show();
			   $('.search_result1').html(data);
		
        }
    });
		
		});

        $('body').on('change','.select_no',function(){
	var ischecked= $(this).is(':checked');
            var value = $(this).val();
						var get_value = $('#CustomerCellPhone').val();
						if(ischecked){
                            
            
            if(get_value==""){
                console.log('here');
                $('#CustomerCellPhone').val(value);

            } 
            else {
                
                

                $('#CustomerCellPhone').val(get_value+","+value);

            }
						}
						else {
                            console.log('unchecked');
							if( get_value.indexOf(',') >= 0){
                               
								get_value = get_value.replace(","+value,'');
                                $('#CustomerCellPhone').val(get_value);
} 
else {
	get_value = get_value.replace(value,'');
	 $('#CustomerCellPhone').val(get_value);
	
}
							
						}
        });
    
</script>
</body>
</html>