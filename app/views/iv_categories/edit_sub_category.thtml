<html> 
<head>
<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/bria_api_constants.js"></script>
<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/bria_api_js_sample.js"></script>
<link rel="stylesheet" type="text/css" media="all" href="<?=ROOT_URL;?>/app/webroot/css/store_tree.css" />
<link rel="stylesheet" type="text/css" media="all" href="<?=ROOT_URL;?>/app/webroot/css/ui-smooth/jquery-ui-1.8.13.custom.css" />
<script>
jQuery( document ).ready(function($) {

 $('.category-id').on('change', function(){
    var catId = $( ".category-id option:selected" ).val();
     $('#catId').val(catId);
 });
 $('#edit-cat').on('click', function(){
    var id = $('#subCatId').val();
    var name = $('#subCatName').val();
    var catId = $('#catId').val();

     jQuery.ajax({
          url: "<?=BASE_URL;?>/iv_categories/addSubCategory",
          type: "POST",
          data: {id:id, name:name, catId:catId},
          success: function(data){
                window.opener.location.reload();
                window.close();
            // location.href = "<?=BASE_URL;?>/iv_categories/showPaymentTypes";
                 //document.forms['viewform'].submit();
             }
        });
    
 });
 $('#removePayment').on('click', function(e){
        var selected = [];
         $("input:checkbox[class=checkboxes]:checked").each(function () {
             selected.push($(this).attr('type_id'));
        });
        jQuery.ajax({
          url: "<?=BASE_URL;?>/iv_categories/deleteSubCategory",
          type: "POST",
          data: {typeIds:selected},
          success: function(data){
            // location.href = "<?=BASE_URL;?>/iv_categories/showPaymentTypes";
                 document.forms['viewform'].submit();
             }
        });
    });   
 $('.sub-category-name').on('click', function(){
            var id = $(this).attr('cat-id');
            window.open("<?=BASE_URL;?>/iv_categories/editSubCategory/"+id, "_blank", "toolbar=yes,scrollbars=yes,resizable=yes,top=300,left=500,width=400,height=400");
        });
});

</script>
<style>
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}
th, td {
  padding: 10px;
}   
.question_button {
    background:url(<?=ROOT_URL;?>/app/webroot/img/iconset_coquette/text_page.png) no-repeat center #666;
    border:1px solid #999;
    border-radius:5px;
    width:25px;
    height:25px;
}

.timeslot_button {
    background:url(<?=ROOT_URL;?>/app/webroot/img/iconset_coquette/calendar.png) no-repeat center #666;
    border:1px solid #999;
    border-radius:5px;
    width:25px;
    height:25px;
}

.item_category_button {
    background:url(<?=ROOT_URL;?>/app/webroot/img/iconset_coquette/tree.png) no-repeat center #666;
    border:1px solid #999;
    border-radius:5px;
    width:25px;
    height:25px;
}
td {
  border: 0px ; border-collapse: ;
}
</style>
</head>
<form method="GET" action="<?= $PHP_SELF?>" name="viewform">
<input type="hidden" name="action" value="view" >
<input type="hidden" name="order" value="<?=$_GET['order']?>">
<input type="hidden" name="sort" value="<?=$_GET['sort']?>">
<input type="hidden" name="currentPage" value="<?=$_GET['currentPage']?>">

</form>
<form >
  <h1>Add/Edit Sub Category</h1>
    <input type="hidden" name="subCatId" id="subCatId" value="<?=$subCategory['id']?>">
    <input type="hidden" name="catId" id="catId" value="<?=$subCategory['category_id']?>">
    <table style="border: 0px ; border-collapse: ;">
        <tr>
            <td><b><label>Sub Category Name:</label></b></td>
            <td><input type="text" id="subCatName" name="catName" value="<?=$subCategory['name']?>"></td>
            <td>
             <select class="category-id">
               <?php foreach($categories as $category) {?>
                  <option <?php if($subCategory['category_id'] == $category['id']){ echo 'selected';}?> value="<?=$category['id']?>"><?php echo $category['name']?></option>
              <?}?>
             </select>
            </td>
       </tr>                
       <tr>
        <td><input type="button" value="Save" id="edit-cat"/></td>
        <td><input type="button" value="Cancel" class="button_cancel" /></td>
       </tr>
    </table>     
</form>