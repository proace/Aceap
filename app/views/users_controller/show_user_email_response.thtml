<html> 
<head>
<link rel="stylesheet" type="text/css" media="all" href="<?=ROOT_URL;?>/app/webroot/css/ui-smooth/jquery-ui-1.8.13.custom.css" />
<link type="text/css" href="<?=ROOT_URL;?>/app/webroot/css/overcast/jquery-ui-1.8.4.custom.css" rel="stylesheet" />
<script language="JavaScript" src="<?=ROOT_URL;?>/app/webroot/js/jquery.js"></script>
<script language="JavaScript" src="<?=ROOT_URL;?>/app/webroot/js/scw.js"></script>
<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/jquery-1.5.1.min.js"></script>
<script type="text/javascript" src="<?=ROOT_URL;?>/app/webroot/js/jquery-ui-1.8.4.custom.min.js"></script>
<script language="JavaScript" src="<?=ROOT_URL;?>/app/webroot/js/tinymce/tinymce.min.js"></script>

<script>
function addTinyMCE(){
        tinyMCE.init({
            selector: '#scheduleEmailVal',
            // mode: 'textareas',
            theme : "modern",
            browser_spellcheck: true,
            plugins : "code,safari,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,visualchars,nonbreaking,xhtmlxtras,template,imagemanager,filemanager, nanospell, link unlink, anchor, image, media",
            external_plugins: {"nanospell": "plugins/nanospell/plugin.js"},
                nanospell_server: "php", // choose "php" "asp" "asp.net" or "java"
            // Theme options
            theme_advanced_buttons1 : "save,newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,fontselect,fontsizeselect,|nanospell",
            theme_advanced_buttons2 : "cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code,|,insertdate,inserttime,preview,|,forecolor,backcolor",
            theme_advanced_buttons3 : "tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,emotions,iespell,media,advhr,|,print,|,ltr,rtl,|,fullscreen",
            theme_advanced_buttons4 : "insertlayer,moveforward,movebackward,absolute,|,styleprops,spellchecker,|,cite,abbr,acronym,del,ins,attribs,|,visualchars,nonbreaking,template,blockquote,pagebreak,|,insertfile,insertimage",
            theme_advanced_toolbar_location : "top",
            theme_advanced_toolbar_align : "left",
            theme_advanced_statusbar_location : "bottom",
            theme_advanced_resizing : true,
            
            // Example content CSS (should be your site CSS)
            content_css : "css/example.css",
            
            convert_urls: true,
            width: 800,
            height: 500,
            template_external_list_url : "js/template_list.js",
            external_link_list_url : "js/link_list.js",
            external_image_list_url : "js/image_list.js",
            media_external_list_url : "js/media_list.js",
            gecko_spellcheck : true, browser_spellcheck : true
        });
    }
jQuery( document ).ready(function($) {
       $(function () {
        $("#sendAnonymousEmail").dialog({
            modal: true,
            autoOpen: false,
            title: "Send Email",
            autoOpen: false,
            width: 1000,
            height: 800,
        });

        $('.reply_email').live('click', function(){
            var emailId = $(this).attr('content_id1');
            $('#email_id').val(emailId);

            if(tinymce.get("scheduleEmailVal")) 
            {
                tinymce.remove('#scheduleEmailVal');
            }
            $('#scheduleEmailVal').val('Write Here');
                    setTimeout(() => {
                        addTinyMCE();   
                    },50);
            $( "#sendAnonymousEmail" ).dialog("open");
        });
    });
      $(function () {
        $(".show_email_content").dialog({
              modal: true,
              autoOpen: false,
              title: "Message",
              autoOpen: false,
              width: 1024,
              height: 786,
          });
          $(".receiveViewContents").live("click",function () {
            var id = $(this).attr("content_id");
            var message = $("#received_log_content_"+id).val();
            $('.show_email_content').html(message);
            $('.show_email_content').dialog('open');
          });
    });
        $('.refreshData').live('click', function(){
            $(this).css("background-color", "#3cb371");
      });
      $('#markAll').live('click', function(){
              $(".delete_email").attr('checked', this.checked);
          });
      $('#deleteAll').live('click', function(){
          var Id = '';
           $(".delete_email:checkbox:checked").each(function(){
              Id += (Id != "")? "," : "";
              Id += $(this).val();
          });
          Updateflag(Id);
      });
});

function Updateflag(Id)
  {
      $.ajax({
      url: "<?=BASE_URL;?>/users/markCheckUserResponse",
      type: "POST",
      data: {id : Id},
      success: function(data){
        res = JSON.parse(data);
            if(res.res == "OK")
            {
                window.location.reload();
            }
        //location.href = "<?=BASE_URL;?>/orders/showFailedEmail";
      }
    });
  }
function hideEmailBox() {
    $( "#sendAnonymousEmail" ).dialog("close");
}

function sendSeparateEmail()
{
    var email = $('#email_id').val();
    var message = tinyMCE.activeEditor.getContent();
    // var subject = $('#subject_val').val();
    $.ajax({
        url: '<?=BASE_URL?>/orders/sendSeparateEmail',
        dataType: 'html',
        type: 'POST',
        cache: false,
        data:{email:email, message:message},
        success: function(data) {
              window.location.reload();
        }
    }); 
}
</script>
<style type="text/css">
.active {
     background-color:  #80ff80 !important;
}
a {
  color: #080808;
  text-decoration: none;  
}
.currentSelected {
  border: none;
  outline: none;
  padding: 10px 16px;
  background-color: #656565;
  cursor: pointer;
}
table {
  width: 100%;
  border-spacing: 0;
  border-collapse: collapse;
  margin-top: 30px;
}

table td,
table th {
  border: 1px solid #dadada;
  padding: 5px;
}
table thead th:nth-child(4){
  width: 30%;
}
.btn{
    float:right;
    padding: 5px;
    margin-right: 5px;
    background: #F5F5F5;
    border-top: 2px solid white;
    border-left: 2px solid white;
    border-bottom: 2px solid #A7A6AA;
    border-right: 2px solid #A7A6AA;
    font-size: 12px;
    font-weight: bold;
    width: 56px;
    height: 26px;
}
.button {
    float: right;
    width: 53px;
    height: 13px;
    margin-right: 5px;
    padding: 5px;
    text-align: center;
}
</style>
</head>
<body>
<table >
    <tr >
        <th>No.</th>
        <th>Date</th>
        <th>Email</th>
        <th>Subject</th>
        <th>Message</th>
        <th><input id="markAll" type="checkbox" name="delete_all">Hide All</th>
    </tr>
        <?php $i=1; foreach ($emails as $email):        
        ?>
        <tr>
            <td><?=$i?></td>
            <td><?=$email['mail_date']?></td>
            <td><?=$email['email']?></td>
            <td><?=$email['subject']?></td>
            <textarea style="display:none" id="received_log_content_<?=$email['id']?>"><?=$email['body']?></textarea>
            <td><input type="button" class="receiveViewContents" name="receiveViewContents" value="View Content"          content_id="<?=$email['id']?>"> <input type="button" class="reply_email" name="reply_email" value="Reply" content_id1="<?=$email['email']?>"></td>
            <td><input type="checkbox" class="delete_email" name="markCheck[]" value="<?=$email['id']?>" ></td>
        </tr>
        <?php $i++; endforeach; ?>
    <?php if($totalPages > 1){?>
        <div style="margin-top: 10px;">
            <?php $j = 1;
            for( $j; $j <= $totalPages; $j++){ ?>
                <a class="currentSelected <?php echo ($pageNo == $j) ? active :'' ?>" href="<?=BASE_URL?>/users/showUserEmailResponse?page_no=<?=$j?>"><?php echo $j ?></a>   
            <?php } ?>
        </div>
    <?php }?>
   <input class="btn" id="deleteAll" type="button" name="Update Status" value="Hide">
   <a class="button refreshData" href="<?=BASE_URL?>/users/showUserEmailResponse?page_no=1">Refresh</a>
</table>
<div class="show_email_content" style="display: none, background-color: #ffffff">
</div>
<div id="sendAnonymousEmail" style="display: none">
        <table>
            <tr>
                <td>
                   <input type="hidden" name="email_id" id="email_id">
              <!--     <span>Subject</span><input type="text" id="subject_val" name="subject_val"> -->
                </td>   
            </tr>
            <tr>
                <td>                
                 <span>Body</span> <textarea id="scheduleEmailVal"></textarea>
            </tr>
        </table>
        <input type="button" name="OK" value="Send" style="padding: 5px;margin-top: 5px;" onclick="sendSeparateEmail()">
        <input type="button"  name="cancel" value="Cancel" onclick="hideEmailBox();" style="padding: 5px;margin-top: 5px;">
</div>
</body>
</html>